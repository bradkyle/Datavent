{"version":3,"sources":["index.js"],"names":["functions","require","app","cookieParser","crud","admin","initializeApp","db","firestore","cors","origin","validateFirebaseIdToken","req","res","next","console","log","headers","authorization","startsWith","cookies","__session","error","status","send","idToken","split","auth","verifyIdToken","then","decodedIdToken","user","catch","use","get","list","post","params","name","delete","exports","route","https","onRequest"],"mappings":"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","file":"index.js","sourcesContent":["const functions = require('firebase-functions');\nconst app = require('express')();\nconst cookieParser = require('cookie-parser')();\nvar crud = require(\"./crud.js\");\n\n// firebase firestore\nconst admin = require('firebase-admin');\nadmin.initializeApp();\nvar db = admin.firestore()\n\nconst cors = require('cors')({ origin: true });\n\n// Express middleware that validates Firebase ID Tokens passed in the Authorization HTTP header.\n// The Firebase ID token needs to be passed as a Bearer token in the Authorization HTTP header like this:\n// `Authorization: Bearer <Firebase ID Token>`.\n// when decoded successfully, the ID Token content will be added as `req.user`.\nconst validateFirebaseIdToken = (req, res, next) => {\n  console.log('Check if request is authorized with Firebase ID token');\n  if ((!req.headers.authorization || !req.headers.authorization.startsWith('Bearer ')) &&\n      !req.cookies.__session) {\n    console.error('No Firebase ID token was passed as a Bearer token in the Authorization header.',\n        'Make sure you authorize your request by providing the following HTTP header:',\n        'Authorization: Bearer <Firebase ID Token>',\n        'or by passing a \"__session\" cookie.');\n    res.status(403).send('Unauthorized');\n    return;\n  }\n  let idToken;\n  if (req.headers.authorization && req.headers.authorization.startsWith('Bearer ')) {\n    console.log('Found \"Authorization\" header');\n    // Read the ID Token from the Authorization header.\n    idToken = req.headers.authorization.split('Bearer ')[1];\n  } else {\n    console.log('Found \"__session\" cookie');\n    // Read the ID Token from cookie.\n    idToken = req.cookies.__session;\n  }\n  admin.auth().verifyIdToken(idToken).then((decodedIdToken) => {\n    console.log('ID Token correctly decoded', decodedIdToken);\n    req.user = decodedIdToken;\n    return next();\n  }).catch((error) => {\n    console.error('Error while verifying Firebase ID token:', error);\n    res.status(403).send('Unauthorized');\n  });\n};\n\napp.use(cors);\napp.use(cookieParser);\napp.use(validateFirebaseIdToken);\n\n// Other\n// -------------------------------------------->\n\napp.get('/hello', (req, res) => {\n  res.send(`Hello`);\n});\n\n// People\n// -------------------------------------------->\n\n// list\napp.get('/person/list', (req, res) => {\n  res.send(crud.list(db, 'people', ''))\n});\n\n// create\napp.post('/person', (req, res) => {\n  res.send(`Hello ${req.params.name}`);\n});\n\n// read\napp.get('/person/:id', (req, res) => {\n  res.send(`Sub function`);\n});\n\n// update\napp.get('/person/:id', (req, res) => {\n  res.send(`Hello ${req.params.name}`);\n});\n\n// delete\napp.delete('/person/:id', (req, res) => {\n  res.send(`Hello ${req.params.name}`);\n});\n\n// Businesses\n// -------------------------------------------->\n\n// list\napp.get('/business/list', (req, res) => {\n  res.send(`Root page`);\n});\n\n// create\napp.post('/business', (req, res) => {\n  res.send(`Hello ${req.params.name}`);\n});\n\n// read\napp.get('/business/:id', (req, res) => {\n  res.send(`Sub function`);\n});\n\n// update\napp.get('/business/:id', (req, res) => {\n  res.send(`Hello ${req.params.name}`);\n});\n\n// delete\napp.delete('/business/:id', (req, res) => {\n  res.send(`Hello ${req.params.name}`);\n});\n\n// Event\n// -------------------------------------------->\n\n// list\napp.get('/event/list', (req, res) => {\n  res.send(`Root page`);\n});\n\n// create\napp.post('/event', (req, res) => {\n  res.send(`Hello ${req.params.name}`);\n});\n\n// read\napp.get('/event/:id', (req, res) => {\n  res.send(`Sub function`);\n});\n\n// update\napp.get('/event/:id', (req, res) => {\n  res.send(`Hello ${req.params.name}`);\n});\n\n// delete\napp.delete('/event/:id', (req, res) => {\n  res.send(`Hello ${req.params.name}`);\n});\n\n// RSVPS\n// -------------------------------------------->\n\n// list\napp.get('/rsvp/list', (req, res) => {\n  res.send(`Root page`);\n});\n\n// create\napp.post('/rsvp', (req, res) => {\n  res.send(`Hello ${req.params.name}`);\n});\n\n// read\napp.get('/rsvp/:id', (req, res) => {\n  res.send(`Sub function`);\n});\n\n// update\napp.get('/rsvp/:id', (req, res) => {\n  res.send(`Hello ${req.params.name}`);\n});\n\n// delete\napp.delete('/rsvp/:id', (req, res) => {\n  res.send(`Hello ${req.params.name}`);\n});\n\n// Tag\n// -------------------------------------------->\n\n// list\napp.get('/business/list', (req, res) => {\n  res.send(`Root page`);\n});\n\n// create\napp.post('/business', (req, res) => {\n  res.send(`Hello ${req.params.name}`);\n});\n\n\n// We name this function \"route\", which you can see is \n// still surfaced in the HTTP URLs below.\nexports.route = functions.https.onRequest(app);"]}